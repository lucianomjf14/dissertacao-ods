<!DOCTYPE html>
<html lang="pt-BR">
<head>    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cidades Inteligentes e ODS - RSL | Luciano Marinho Silveira</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #007bff;
        }
        
        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        
        .btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn:hover {
            background-color: #0056b3;
        }
        
        .btn-danger {
            background-color: #dc3545;
        }
        
        .btn-danger:hover {
            background-color: #c82333;
        }
        
        .btn-success {
            background-color: #28a745;
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
          .column-selector {
            max-height: 400px;
            overflow-y: auto;
            padding: 0;
            background-color: white;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .column-selector-header {
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            transition: background-color 0.2s;
        }
        
        .column-selector-header:hover {
            background: #e9ecef;
        }
        
        .column-selector-content {
            padding: 15px;
            display: none;
        }
        
        .column-selector-content.show {
            display: block;
        }
        
        .toggle-icon {
            transition: transform 0.3s ease;
            font-size: 1.2em;
            color: #6c757d;
        }
        
        .toggle-icon.expanded {
            transform: rotate(180deg);
        }
        
        .expand-hint {
            font-size: 12px;
            color: #6c757d;
            font-weight: normal;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        
        .checkbox-container:hover {
            background-color: #f0f0f0;
        }
        
        .checkbox-container input {
            margin-right: 10px;
        }
        
        .col-name {
            font-weight: 500;
            color: #333;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        #mainTable {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
          #mainTable th {
            background-color: #007bff;
            color: white;
            padding: 10px 8px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #0056b3;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        #mainTable td {
            padding: 8px;
            border: 1px solid #ddd;
            background-color: white;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainTable tr:nth-child(even) td {
            background-color: #f8f9fa;
        }
        
        .hidden-column {
            display: none !important;
        }
          .ods-icon {
            width: 30px;
            height: 30px;
            margin: 2px;
            border-radius: 3px;
            display: inline-block;
        }
        
        .csc-pillar-icon {
            width: 30px;
            height: 30px;
            margin: 2px;
            border-radius: 3px;
            display: inline-block;
            object-fit: contain;
        }
        
        .ods-geral {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 2px;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
          .status-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .debug-info {
            margin-top: 20px;
            padding: 15px;
            background-color: #f1f3f4;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }

        /* ESTILOS DAS M√âTRICAS DOS ODS */
        .metrics-section {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            padding: 30px;
            margin: 20px 0;
            border-radius: 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .metric-title {
            font-size: 1rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }        .ods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .ods-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.6s cubic-bezier(0.4, 0.0, 0.2, 1);
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
            transform-origin: center;
        }

        .ods-card.sorting {
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 10;
        }

        .ods-card:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #007bff;
        }

        .ods-card.sorting:hover {
            transform: translateY(-3px) scale(1.02);
        }

        .ods-card .ods-icon {
            width: 50px;
            height: 50px;
            border-radius: 6px;
            object-fit: contain;
            margin-bottom: 8px;
        }

        .ods-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            font-size: 0.8rem;
        }

        .ods-count {
            font-size: 1.5rem;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 3px;
        }

        .ods-percentage {
            color: #666;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .details-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -3px 0 10px rgba(0,0,0,0.2);
            transition: right 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .details-panel.active {
            right: 0;
        }

        .details-header {
            background: #007bff;
            color: white;
            padding: 20px;
            position: sticky;
            top: 0;
        }

        .details-content {
            padding: 20px;
        }

        .study-card {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
            border-left: 3px solid #007bff;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: transparent;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        .view-toggle {
            margin-bottom: 20px;
        }

        .toggle-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }

        .toggle-btn:hover {
            background: #218838;
        }

        .toggle-btn.active {
            background: #dc3545;
        }        .hidden {
            display: none !important;
        }

        /* ESTILOS PARA MELHORIAS DA SE√á√ÉO DE M√âTRICAS */
        .enhanced-metrics {
            margin: 20px 0;
        }

        .metrics-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #dee2e6;
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 12px 20px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-btn:hover {
            background: #f8f9fa;
        }

        .tab-btn.active {
            background: #007bff;
            color: white;
            border-bottom-color: #007bff;
        }

        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        .filters-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #dee2e6;
        }

        .filter-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .filter-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-item label {
            font-weight: bold;
            color: #495057;
            font-size: 0.9rem;
        }

        .filter-item select, .filter-item input {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .advanced-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .temporal-analysis {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-weight: bold;
            margin-left: 10px;
        }

        .trend-up {
            color: #28a745;
        }

        .trend-down {
            color: #dc3545;
        }

        .trend-stable {
            color: #ffc107;
        }

        .correlation-matrix {
            overflow-x: auto;
            margin: 20px 0;
        }

        .correlation-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
        }

        .correlation-table th,
        .correlation-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .correlation-table th {
            background: #007bff;
            color: white;
            font-weight: bold;
        }

        .correlation-high {
            background: #d4edda;
            color: #155724;
        }

        .correlation-medium {
            background: #fff3cd;
            color: #856404;
        }        .correlation-low {
            background: #f8d7da;
            color: #721c24;
        }

        /* BOT√ÉO DE CLASSIFICA√á√ÉO DISCRETO */
        .sort-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            z-index: 100;
        }

        .sort-btn {
            background: rgba(0, 123, 255, 0.1);
            border: 1px solid rgba(0, 123, 255, 0.3);
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.8rem;
            color: #007bff;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .sort-btn:hover {
            background: rgba(0, 123, 255, 0.2);
            border-color: rgba(0, 123, 255, 0.5);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15);
        }

        .sort-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .sort-icon {
            transition: transform 0.3s ease;
        }

        .sort-btn.desc .sort-icon {
            transform: rotate(180deg);
        }        /* ANIMA√á√ïES DE CLASSIFICA√á√ÉO APRIMORADAS */
        @keyframes cardSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes cardPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .ods-card.moving {
            z-index: 1000;
            transition: none !important;
            position: relative;
        }

        .ods-card.new-position {
            animation: cardSlideIn 0.4s cubic-bezier(0.4, 0.0, 0.2, 1) 0.3s both;
        }

        .ods-card.highlight {
            animation: cardPulse 0.4s ease-in-out;
            border-color: #28a745;
            box-shadow: 0 4px 20px rgba(40, 167, 69, 0.3);
        }

        /* OVERLAY DE REORGANIZA√á√ÉO */
        .reorganizing-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(2px);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .reorganizing-overlay.active {
            opacity: 1;
        }

        /* INDICADOR DE POSI√á√ÉO */
        .position-indicator {
            position: absolute;
            top: 5px;
            left: 5px;
            background: #007bff;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .ods-card.show-position .position-indicator {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">        <div class="header">
            <h1>Cidades Inteligentes como Vetores para os ODS</h1>
            <h2 style="color: #6c757d; font-weight: 300; margin: 10px 0;">An√°lise de Conte√∫do - Revis√£o Sistem√°tica da Literatura</h2>
            <div style="margin-top: 15px; font-size: 0.9rem; color: #6c757d;">
                <div><strong>Universidade Est√°cio de S√° - UNESA</strong></div>
                <div>Programa de P√≥s-Gradua√ß√£o em Administra√ß√£o e Desenvolvimento Empresarial</div>
                <div>Mestrado em Administra√ß√£o e Desenvolvimento Empresarial</div>
            </div>
        </div>
          <div class="controls">
            <h3>Controles de Visualiza√ß√£o</h3>
            <div class="view-toggle">                <button class="toggle-btn" id="tableViewBtn" onclick="showTableView()">Visualiza√ß√£o Tabela</button>
                <button class="toggle-btn" id="metricsViewBtn" onclick="showMetricsView()">Visualiza√ß√£o M√©tricas ODS</button>
            </div>
            <div id="tableControls">
                <h4>Controles de Colunas</h4>
                <div>                    <button class="btn btn-success" onclick="selectAllColumns()">Marcar Todas</button>
                    <button class="btn btn-danger" onclick="deselectAllColumns()">Desmarcar Todas</button>
                    <button class="btn" onclick="resetToDefaultColumns()">Padr√£o</button>
                    <button class="btn" onclick="showOnlyODSColumns()">Apenas ODS</button>
                    <button class="btn" onclick="showOnlyCSCColumns()">Apenas Pilares CSC</button>
                </div>
                
                <div class="status status-info" id="statusMessage">
                    Pronto para uso. Use os bot√µes acima para controlar as colunas.
                </div>
            </div>
        </div>        <div class="column-selector" id="columnSelector">
            <div class="column-selector-header" onclick="toggleColumnSelector()">
                <div>
                    <h4 style="margin: 0;">Selecionar Colunas</h4>
                    <span class="expand-hint">Clique para expandir/colapsar</span>
                </div>
                <span class="toggle-icon" id="toggleIcon">‚ñº</span>
            </div>
            <div class="column-selector-content" id="columnSelectorContent">
                <div id="checkboxContainer"></div>
            </div>
        </div>        <!-- SE√á√ÉO DE M√âTRICAS DOS ODS -->
        <div id="metricsSection" class="hidden">
            <!-- Filtros Interativos -->
            <div class="filters-section">
                <h3>Filtros Interativos</h3>
                <div class="filter-group">
                    <div class="filter-item">
                        <label for="yearFilter">Ano de Publica√ß√£o:</label>
                        <select id="yearFilter" onchange="applyFilters()">
                            <option value="">Todos os anos</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="journalFilter">Peri√≥dico:</label>
                        <select id="journalFilter" onchange="applyFilters()">
                            <option value="">Todos os peri√≥dicos</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="odsFilter">ODS Espec√≠fico:</label>
                        <select id="odsFilter" onchange="applyFilters()">
                            <option value="">Todos os ODS</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label>&nbsp;</label>
                        <button class="btn" onclick="clearFilters()">Limpar Filtros</button>
                    </div>
                </div>
            </div>

            <!-- Abas de Navega√ß√£o -->
            <div class="metrics-tabs">                <button class="tab-btn active" onclick="switchTab('overview')">Vis√£o Geral</button>
                <button class="tab-btn" onclick="switchTab('charts')">Gr√°ficos</button>
                <button class="tab-btn" onclick="switchTab('temporal')">An√°lise Temporal</button>
                <button class="tab-btn" onclick="switchTab('advanced')">M√©tricas Avan√ßadas</button>
            </div>

            <!-- Aba: Vis√£o Geral -->
            <div id="overviewTab" class="tab-content">
                <div class="metrics-section">
                    <h2 style="text-align: center; margin-bottom: 20px;">M√©tricas dos ODS</h2>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-title">Total de Estudos</div>
                            <div class="metric-value" id="totalStudies">41</div>
                            <div>Corpus completo analisado</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-title">ODS mais Frequente</div>
                            <div class="metric-value" id="mostFrequentODS">ODS 11</div>
                            <div id="mostFrequentCount">Calculando...</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-title">Estudos "Geral"</div>
                            <div class="metric-value" id="generalStudies">0</div>
                            <div id="generalPercentage">Calculando...</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-title">ODS Identificados</div>
                            <div class="metric-value" id="identifiedODS">0</div>
                            <div>de 17 ODS</div>
                        </div>
                    </div>
                </div>                <div style="text-align: center; margin: 20px 0;">                    <button class="btn" onclick="showAllStudies()">Ver Todos os Estudos</button>
                    <button class="btn" onclick="showStatistics()">Estat√≠sticas Detalhadas</button>
                </div>                <div style="position: relative;">
                    <div class="sort-controls">
                        <button class="sort-btn" id="sortBtn" onclick="toggleOdsSort()">
                            <span class="sort-icon">‚Üï</span>
                            <span id="sortText">Classificar por %</span>
                        </button>
                    </div>
                    
                    <div class="reorganizing-overlay" id="reorganizingOverlay"></div>
                    
                    <div class="ods-grid" id="odsGrid">
                        <!-- Os cart√µes dos ODS ser√£o inseridos aqui pelo JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Aba: Gr√°ficos -->
            <div id="chartsTab" class="tab-content hidden">
                <div class="chart-container">
                    <h3>Distribui√ß√£o dos ODS</h3>
                    <div class="chart-wrapper">
                        <canvas id="odsDistributionChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>Ranking dos ODS</h3>
                    <div class="chart-wrapper">
                        <canvas id="odsRankingChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Aba: An√°lise Temporal -->
            <div id="temporalTab" class="tab-content hidden">
                <div class="temporal-analysis">
                    <h3>Evolu√ß√£o Temporal dos Estudos</h3>
                    <div class="chart-wrapper">
                        <canvas id="temporalChart"></canvas>
                    </div>
                </div>

                <div class="advanced-stats" id="temporalStats">
                    <!-- Estat√≠sticas temporais ser√£o inseridas aqui -->
                </div>
            </div>

            <!-- Aba: M√©tricas Avan√ßadas -->
            <div id="advancedTab" class="tab-content hidden">
                <div class="advanced-stats" id="advancedStats">
                    <!-- M√©tricas avan√ßadas ser√£o inseridas aqui -->
                </div>

                <div class="chart-container">
                    <h3>Correla√ß√£o entre ODS</h3>
                    <div class="correlation-matrix" id="correlationMatrix">
                        <!-- Matriz de correla√ß√£o ser√° inserida aqui -->
                    </div>
                </div>
            </div>
        </div>

        <div class="table-container" id="tableSection">
            <table id="mainTable">
                <thead id="tableHeader"></thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>

        <!-- Painel de detalhes -->
        <div class="details-panel" id="detailsPanel">
            <div class="details-header">
                <button class="close-btn" onclick="closeDetails()">&times;</button>
                <h3 id="detailsTitle">Detalhes</h3>
                <p id="detailsSubtitle"></p>
            </div>
            <div class="details-content" id="detailsContent">
                <!-- Conte√∫do ser√° inserido pelo JavaScript -->
            </div>        </div>        <div id="debugInfo" class="debug-info">
            <strong>Debug Info:</strong><br>
            <div id="debugContent">Carregando...</div>
        </div>
    </div>

    <script src="dados_javascript.js"></script>
    <script>
        // FUN√á√ÉO DE DEBUG VISUAL
        function addDebugMessage(message) {
            const debugContent = document.getElementById('debugContent');
            if (debugContent) {
                debugContent.innerHTML += message + '<br>';
            }
        }
        
        // VARI√ÅVEIS GLOBAIS
        let tableData = [];
        let columnNames = [];
        let defaultColumns = ['ID', 'Autores', 'T√≠tulo', 'Ano', 'ODS (Geral / Espec√≠fico)', 'Aspecto Principal - Estudo', 'Pilar CSC', 'Indicadores CSC'];
        
        // DADOS DA TABELA
        
        const columns = ["Link", "ID", "Autores", "T√≠tulo", "Ano", "Peri√≥dico", "Idioma", "DOI", "ISSN", "Categorias", "Status", "Palavras Chave", "Trechos correla√ß√µes", "ODS (Geral / Espec√≠fico)", "Aspecto Principal - Estudo", "Aspectos relacionados", "Impactos / Resultados", "Pilar CSC", "Indicadores CSC", "CORPUS - IRAMUTEQ"];          // MAPEAMENTO DE √çCONES ODS
        const odsIcons = {
            'ODS 1': '√çcones oficiais - ODS/SDG-icon-PT--01-2-01.png',
            'ODS 2': '√çcones oficiais - ODS/SDG-icon-PT--02-2.png',
            'ODS 3': '√çcones oficiais - ODS/SDG-icon-PT--03-2.png',
            'ODS 4': '√çcones oficiais - ODS/SDG-icon-PT--04-2-01.png',
            'ODS 5': '√çcones oficiais - ODS/SDG-icon-PT--05-2.png',
            'ODS 6': '√çcones oficiais - ODS/SDG-icon-PT--06-2-01.png',
            'ODS 7': '√çcones oficiais - ODS/SDG-icon-PT--07-2-01.png',
            'ODS 8': '√çcones oficiais - ODS/SDG-icon-PT--08-2-01.png',
            'ODS 9': '√çcones oficiais - ODS/SDG-icon-PT--09-2.png',
            'ODS 10': '√çcones oficiais - ODS/SDG-icon-PT--10-2.png',
            'ODS 11': '√çcones oficiais - ODS/SDG-icon-PT--11-2.png',
            'ODS 12': '√çcones oficiais - ODS/SDG-icon-PT--12-2-01.png',
            'ODS 13': '√çcones oficiais - ODS/SDG-icon-PT--13-2.png',
            'ODS 14': '√çcones oficiais - ODS/SDG-icon-PT--14-2-01.png',
            'ODS 15': '√çcones oficiais - ODS/SDG-icon-PT--15-2-01.png',
            'ODS 16': '√çcones oficiais - ODS/SDG-icon-PT--16-2.png',
            'ODS 17': '√çcones oficiais - ODS/SDG-icon-PT--17-2.png',
            'Geral': 'logo-sepado.png',
            // Vers√£o num√©rica para compatibilidade
            "1": "√çcones oficiais - ODS/SDG-icon-PT--01-2-01.png", 
            "2": "√çcones oficiais - ODS/SDG-icon-PT--02-2.png", 
            "3": "√çcones oficiais - ODS/SDG-icon-PT--03-2.png", 
            "4": "√çcones oficiais - ODS/SDG-icon-PT--04-2-01.png", 
            "5": "√çcones oficiais - ODS/SDG-icon-PT--05-2.png", 
            "6": "√çcones oficiais - ODS/SDG-icon-PT--06-2-01.png", 
            "7": "√çcones oficiais - ODS/SDG-icon-PT--07-2-01.png", 
            "8": "√çcones oficiais - ODS/SDG-icon-PT--08-2-01.png", 
            "9": "√çcones oficiais - ODS/SDG-icon-PT--09-2.png", 
            "10": "√çcones oficiais - ODS/SDG-icon-PT--10-2.png", 
            "11": "√çcones oficiais - ODS/SDG-icon-PT--11-2.png", 
            "12": "√çcones oficiais - ODS/SDG-icon-PT--12-2-01.png", 
            "13": "√çcones oficiais - ODS/SDG-icon-PT--13-2.png", 
            "14": "√çcones oficiais - ODS/SDG-icon-PT--14-2-01.png", 
            "15": "√çcones oficiais - ODS/SDG-icon-PT--15-2-01.png", 
            "16": "√çcones oficiais - ODS/SDG-icon-PT--16-2.png", 
            "17": "√çcones oficiais - ODS/SDG-icon-PT--17-2.png"
        };

        // MAPEAMENTO DE √çCONES DOS PILARES CSC
        const cscPillarIcons = {
            'Economia': '√≠cones oficiais - CSC/Economia.png',
            'Educa√ß√£o': '√≠cones oficiais - CSC/Educa√ß√£o.png',
            'Empreendedorismo': '√≠cones oficiais - CSC/Empreendedorismo.png',
            'Energia': '√≠cones oficiais - CSC/Energia.png',
            'Governan√ßa': '√≠cones oficiais - CSC/Governan√ßa.png',
            'Meio Ambiente': '√≠cones oficiais - CSC/Meio Ambiente.png',
            'Mobilidade': '√≠cones oficiais - CSC/Mobilidade.png',
            'Sa√∫de': '√≠cones oficiais - CSC/Sa√∫de.png',
            'Seguran√ßa': '√≠cones oficiais - CSC/Seguran√ßa.png',
            'Tecnologia e Inova√ß√£o': '√≠cones oficiais - CSC/Tecnologia e Inova√ß√£o .png',
            'Urbanismo': '√≠cones oficiais - CSC/Urbanismo.png'
        };
        // STATUS MESSAGE
        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('statusMessage');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.className = `status status-${type}`;
            }
            console.log('STATUS:', message, type);
        }        // INICIALIZA√á√ÉO
        function initializeApp() {
            addDebugMessage('üîç Iniciando aplica√ß√£o...');
            
            // Verificar se os dados foram carregados
            if (typeof data === 'undefined') {
                console.error('Dados n√£o carregados! Verifique se dados_javascript.js foi carregado corretamente.');
                updateStatus('ERRO: Dados n√£o encontrados. Verifique se dados_javascript.js existe.', 'error');
                addDebugMessage('‚ùå ERRO: Vari√°vel "data" n√£o encontrada!');
                return;
            }
            
            addDebugMessage(`‚úÖ Dados carregados: ${data.length} estudos`);
            console.log('Dados carregados:', data.length, 'estudos');
            tableData = data;
            columnNames = columns;
            
            createColumnCheckboxes();
            renderTable();
            
            updateStatus(`Aplica√ß√£o carregada: ${tableData.length} registros, ${columnNames.length} colunas`);
            addDebugMessage(`üìä Tabela inicializada: ${tableData.length} registros, ${columnNames.length} colunas`);
        }
        
        // CRIAR CHECKBOXES DAS COLUNAS
        function createColumnCheckboxes() {
            
            const container = document.getElementById('checkboxContainer');
            if (!container) {
                return;
            }
            
            container.innerHTML = '';
            
            columnNames.forEach((columnName, index) => {
                const isDefault = defaultColumns.includes(columnName);
                
                const checkboxDiv = document.createElement('div');
                checkboxDiv.className = 'checkbox-container';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `col_${index}`;
                checkbox.value = index;
                checkbox.checked = isDefault;
                checkbox.onchange = function() { toggleColumn(index); };
                
                const label = document.createElement('label');
                label.htmlFor = `col_${index}`;
                label.innerHTML = `<span class="col-name">${columnName}</span>`;
                
                checkboxDiv.appendChild(checkbox);
                checkboxDiv.appendChild(label);
                container.appendChild(checkboxDiv);
            });
            
        }
        
        // TOGGLE COLUMN VISIBILITY
        function toggleColumn(columnIndex) {
            const checkbox = document.getElementById(`col_${columnIndex}`);
            if (!checkbox) {
                return;
            }
            
            const isVisible = checkbox.checked;
            const thElements = document.querySelectorAll(`#mainTable th:nth-child(${columnIndex + 1})`);
            const tdElements = document.querySelectorAll(`#mainTable td:nth-child(${columnIndex + 1})`);
            
            // Aplicar/remover classe hidden
            [...thElements, ...tdElements].forEach(element => {
                if (isVisible) {
                    element.classList.remove('hidden-column');
                } else {
                    element.classList.add('hidden-column');
                }
            });
            
        }
        
        // FUN√á√ÉO PRINC√çPAL: DESMARCAR TODAS AS COLUNAS
        function deselectAllColumns() {
            updateStatus('Desmarcando todas as colunas...', 'info');
            
            const checkboxes = document.querySelectorAll('#checkboxContainer input[type="checkbox"]');
            
            if (checkboxes.length === 0) {
                updateStatus('ERRO: Nenhum checkbox encontrado!', 'error');
                return;
            }
            
            let processedCount = 0;
            
            // Processar cada checkbox
            checkboxes.forEach((checkbox, index) => {
                const columnIndex = parseInt(checkbox.value);
                
                // Desmarcar checkbox
                checkbox.checked = false;
                
                // Ocultar coluna
                const thElements = document.querySelectorAll(`#mainTable th:nth-child(${columnIndex + 1})`);
                const tdElements = document.querySelectorAll(`#mainTable td:nth-child(${columnIndex + 1})`);
                
                [...thElements, ...tdElements].forEach(element => {
                    element.classList.add('hidden-column');
                });
                
                processedCount++;
            });
            
            updateStatus(`SUCESSO: ${processedCount} colunas desmarcadas`, 'success');
            
            // Verifica√ß√£o final
            setTimeout(() => {
                const visibleColumns = document.querySelectorAll('#mainTable th:not(.hidden-column)').length;
                const hiddenColumns = document.querySelectorAll('#mainTable th.hidden-column').length;
                
                if (hiddenColumns === columnNames.length) {
                    updateStatus('‚úÖ PERFEITO: Todas as colunas foram desmarcadas!', 'success');
                } else {
                    updateStatus(`‚ö†Ô∏è ATEN√á√ÉO: ${visibleColumns} colunas ainda vis√≠veis`, 'warning');
                }
            }, 100);
        }
        
        // MARCAR TODAS AS COLUNAS
        function selectAllColumns() {
            updateStatus('Marcando todas as colunas...', 'info');
            
            const checkboxes = document.querySelectorAll('#checkboxContainer input[type="checkbox"]');
            let processedCount = 0;
            
            checkboxes.forEach((checkbox, index) => {
                const columnIndex = parseInt(checkbox.value);
                checkbox.checked = true;
                
                const thElements = document.querySelectorAll(`#mainTable th:nth-child(${columnIndex + 1})`);
                const tdElements = document.querySelectorAll(`#mainTable td:nth-child(${columnIndex + 1})`);
                
                [...thElements, ...tdElements].forEach(element => {
                    element.classList.remove('hidden-column');
                });
                
                processedCount++;
            });
            
            updateStatus(`${processedCount} colunas selecionadas`, 'success');
        }
        
        // RESETAR PARA PADR√ÉO
        function resetToDefaultColumns() {
            updateStatus('Resetando para configura√ß√£o padr√£o...', 'info');
            
            const checkboxes = document.querySelectorAll('#checkboxContainer input[type="checkbox"]');
            let selectedCount = 0;
            
            checkboxes.forEach((checkbox, index) => {
                const columnIndex = parseInt(checkbox.value);
                const columnName = columnNames[columnIndex];
                const shouldBeVisible = defaultColumns.includes(columnName);
                
                checkbox.checked = shouldBeVisible;
                
                const thElements = document.querySelectorAll(`#mainTable th:nth-child(${columnIndex + 1})`);
                const tdElements = document.querySelectorAll(`#mainTable td:nth-child(${columnIndex + 1})`);
                
                [...thElements, ...tdElements].forEach(element => {
                    if (shouldBeVisible) {
                        element.classList.remove('hidden-column');
                        selectedCount++;
                    } else {
                        element.classList.add('hidden-column');
                    }
                });
            });
            
            updateStatus(`Configura√ß√£o padr√£o: ${selectedCount} colunas`, 'success');
        }
        
        // MOSTRAR APENAS COLUNAS ODS
        function showOnlyODSColumns() {
            
            const odsRelatedColumns = ['ID', 'T√≠tulo', 'ODS (Geral / Espec√≠fico)'];
            const checkboxes = document.querySelectorAll('#checkboxContainer input[type="checkbox"]');
            let selectedCount = 0;
            
            checkboxes.forEach((checkbox, index) => {
                const columnIndex = parseInt(checkbox.value);
                const columnName = columnNames[columnIndex];
                const shouldBeVisible = odsRelatedColumns.some(odsCol => columnName.includes(odsCol));
                
                checkbox.checked = shouldBeVisible;
                
                const thElements = document.querySelectorAll(`#mainTable th:nth-child(${columnIndex + 1})`);
                const tdElements = document.querySelectorAll(`#mainTable td:nth-child(${columnIndex + 1})`);
                
                [...thElements, ...tdElements].forEach(element => {
                    if (shouldBeVisible) {
                        element.classList.remove('hidden-column');
                        selectedCount++;
                    } else {
                        element.classList.add('hidden-column');
                    }
                });
            });
            
            updateStatus(`Modo ODS: ${selectedCount} colunas`, 'success');
        }
        
        // MOSTRAR APENAS COLUNAS PILARES CSC
        function showOnlyCSCColumns() {
            const cscRelatedColumns = ['ID', 'T√≠tulo', 'Pilar CSC', 'Indicadores CSC'];
            const checkboxes = document.querySelectorAll('#checkboxContainer input[type="checkbox"]');
            let selectedCount = 0;
            
            checkboxes.forEach((checkbox, index) => {
                const columnIndex = parseInt(checkbox.value);
                const columnName = columnNames[columnIndex];
                const shouldBeVisible = cscRelatedColumns.some(cscCol => columnName.includes(cscCol));
                
                checkbox.checked = shouldBeVisible;
                
                const thElements = document.querySelectorAll(`#mainTable th:nth-child(${columnIndex + 1})`);
                const tdElements = document.querySelectorAll(`#mainTable td:nth-child(${columnIndex + 1})`);
                
                [...thElements, ...tdElements].forEach(element => {
                    if (shouldBeVisible) {
                        element.classList.remove('hidden-column');
                        selectedCount++;
                    } else {
                        element.classList.add('hidden-column');
                    }
                });
            });
            
            updateStatus(`Modo Pilares CSC: ${selectedCount} colunas`, 'success');
        }
          // RENDERIZAR TABELA
        function renderTable() {
            console.log('Renderizando tabela...');
            console.log('tableData:', tableData ? tableData.length : 'n√£o definido');
            console.log('columnNames:', columnNames ? columnNames.length : 'n√£o definido');
            
            const headerContainer = document.getElementById('tableHeader');
            const bodyContainer = document.getElementById('tableBody');
            
            if (!headerContainer || !bodyContainer) {
                console.error('Containers da tabela n√£o encontrados!');
                return;
            }
            
            if (!tableData || tableData.length === 0) {
                console.error('Dados da tabela n√£o dispon√≠veis!');
                bodyContainer.innerHTML = '<tr><td colspan="20" style="text-align: center; padding: 20px; color: red;">‚ùå Nenhum dado encontrado</td></tr>';
                return;
            }
            
            // Cabe√ßalho
            const headerRow = document.createElement('tr');
            columnNames.forEach((columnName, index) => {
                const th = document.createElement('th');
                th.textContent = columnName;
                if (!defaultColumns.includes(columnName)) {
                    th.classList.add('hidden-column');
                }
                headerRow.appendChild(th);
            });
            headerContainer.innerHTML = '';
            headerContainer.appendChild(headerRow);
            
            // Corpo da tabela
            bodyContainer.innerHTML = '';
            tableData.forEach((row, rowIndex) => {
                const tr = document.createElement('tr');                  columnNames.forEach((columnName, columnIndex) => {
                    const td = document.createElement('td');
                    let cellValue = row[columnName] || '';
                    
                    // Processamento especial para coluna ID (criar hiperlink)
                    if (columnName === 'ID' && cellValue && row['Link']) {
                        const link = document.createElement('a');
                        link.href = row['Link'];
                        link.target = '_blank';
                        link.textContent = cellValue;
                        link.style.color = '#007bff';
                        link.style.textDecoration = 'none';
                        link.style.fontWeight = 'bold';
                        link.addEventListener('mouseenter', function() {
                            this.style.textDecoration = 'underline';
                        });
                        link.addEventListener('mouseleave', function() {
                            this.style.textDecoration = 'none';
                        });
                        td.appendChild(link);
                    }
                    // Processamento especial para coluna ODS
                    else if (columnName === 'ODS (Geral / Espec√≠fico)' && cellValue) {
                        td.innerHTML = formatODSCell(cellValue);
                    } 
                    // Processamento especial para coluna Pilar CSC
                    else if (columnName === 'Pilar CSC' && cellValue) {
                        td.innerHTML = formatCSCPillarCell(cellValue);
                    } 
                    else {
                        td.textContent = cellValue;
                    }
                    
                    if (!defaultColumns.includes(columnName)) {
                        td.classList.add('hidden-column');
                    }
                    
                    tr.appendChild(td);
                });
                  bodyContainer.appendChild(tr);
            });
            
            console.log('Tabela renderizada com sucesso!', tableData.length, 'linhas');
        }        // FORMATAR C√âLULA ODS COM √çCONES
        function formatODSCell(value) {
            if (!value) return '';
            
            const valueStr = String(value).trim();
            
            // Caso especial para "Geral" - usar logo circular dos ODS
            if (valueStr.toLowerCase().includes('geral')) {
                return `<div style="display: flex; flex-direction: column; align-items: center; gap: 5px;">
                    <img src="logo-sepado.png" alt="ODS Geral" class="ods-icon" title="Objetivos de Desenvolvimento Sustent√°vel" style="width: 40px; height: 40px; border-radius: 50%;">
                    <span style="font-size: 10px; text-align: center;">Geral</span>
                </div>`;
            }
            
            // Buscar padr√µes "ODS X" no texto (onde X √© o n√∫mero)
            const odsMatches = valueStr.match(/ODS\s+(\d{1,2})/g) || [];
            
            if (odsMatches.length > 0) {
                const icons = odsMatches.map(match => {
                    const odsKey = match.replace(/\s+/g, ' '); // Normalizar espa√ßos
                    const iconPath = odsIcons[odsKey];
                    if (iconPath) {
                        return `<img src="${iconPath}" alt="${odsKey}" class="ods-icon" title="${odsKey}">`;
                    }
                    return '';
                }).filter(icon => icon !== '').join('');
                
                if (icons) {
                    return `<div style="display: flex; flex-direction: column; align-items: center; gap: 5px;">
                        <div style="display: flex; justify-content: center; gap: 3px; flex-wrap: wrap;">${icons}</div>
                        <span style="font-size: 11px; text-align: center; line-height: 1.2;">${valueStr}</span>
                    </div>`;
                }
            }
            
            return valueStr;
        }        // FORMATAR C√âLULA PILAR CSC COM √çCONES
        function formatCSCPillarCell(value) {
            if (!value) return '';
            
            const valueStr = String(value).trim();
            
            // Dividir os pilares por v√≠rgula e limpar espa√ßos
            const pillars = valueStr.split(',').map(pillar => pillar.trim()).filter(pillar => pillar);
            
            if (pillars.length === 0) return valueStr;
            
            // Gerar √≠cones para cada pilar encontrado
            const icons = pillars.map(pillar => {
                const iconPath = cscPillarIcons[pillar];
                if (iconPath) {
                    return `<img src="${iconPath}" alt="${pillar}" class="csc-pillar-icon" title="${pillar}">`;
                }
                return '';
            }).filter(icon => icon !== '').join(' ');
            
            if (icons) {
                return `<div style="display: flex; flex-direction: column; align-items: center; gap: 5px;">
                    <div style="display: flex; justify-content: center; gap: 3px; flex-wrap: wrap;">${icons}</div>
                    <span style="font-size: 11px; text-align: center; line-height: 1.2;">${valueStr}</span>
                </div>`;
            }
            
            return valueStr;
        }
        
        // FUN√á√ÉO PARA COLAPSAR/EXPANDIR SELETOR DE COLUNAS
        function toggleColumnSelector() {
            const content = document.getElementById('columnSelectorContent');
            const icon = document.getElementById('toggleIcon');
            
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                icon.classList.remove('expanded');
                icon.textContent = '‚ñº';
            } else {
                content.classList.add('show');
                icon.classList.add('expanded');
                icon.textContent = '‚ñ≤';
            }        }        // FUN√á√ïES DAS M√âTRICAS DOS ODS
        let odsMetrics = {};
        let filteredData = [];
        let charts = {};
        let sortState = { active: false, descending: true }; // Estado da classifica√ß√£o
        const odsKeys = ['ODS 1', 'ODS 2', 'ODS 3', 'ODS 4', 'ODS 5', 'ODS 6', 'ODS 7', 'ODS 8', 'ODS 9', 'ODS 10', 'ODS 11', 'ODS 12', 'ODS 13', 'ODS 14', 'ODS 15', 'ODS 16', 'ODS 17', 'Geral'];function calculateOdsMetrics() {
            addDebugMessage('üîÑ Calculando m√©tricas dos ODS...');
            
            // Verificar se os dados est√£o dispon√≠veis
            if (typeof data === 'undefined' || !data || data.length === 0) {
                console.error('Dados n√£o dispon√≠veis para calcular m√©tricas');
                addDebugMessage('‚ùå ERRO: Dados n√£o dispon√≠veis para m√©tricas');
                return;
            }
            
            addDebugMessage(`‚úÖ Iniciando c√°lculo para ${data.length} estudos`);
            console.log('Calculando m√©tricas para', data.length, 'estudos');
            
            odsKeys.forEach(ods => {
                const count = data.filter(item => item[ods] === 'x').length;
                const percentage = data.length > 0 ? (count / data.length * 100).toFixed(1) : 0;
                odsMetrics[ods] = { count, percentage };
                console.log(`${ods}: ${count} estudos (${percentage}%)`);
            });

            addDebugMessage(`üìä M√©tricas calculadas com sucesso`);
              // Atualizar m√©tricas na interface
            const totalStudiesEl = document.getElementById('totalStudies');
            if (totalStudiesEl) {
                totalStudiesEl.textContent = data.length;
                addDebugMessage(`‚úÖ Total de estudos atualizado: ${data.length}`);
            } else {
                addDebugMessage('‚ùå ERRO: Elemento totalStudies n√£o encontrado');
            }
            
            // Encontrar ODS mais frequente
            const sortedOds = odsKeys.slice(0, 17).sort((a, b) => odsMetrics[b].count - odsMetrics[a].count);
            const mostFrequent = sortedOds[0];
            
            const mostFrequentODSEl = document.getElementById('mostFrequentODS');
            const mostFrequentCountEl = document.getElementById('mostFrequentCount');
            
            if (mostFrequentODSEl && mostFrequentCountEl) {
                mostFrequentODSEl.textContent = mostFrequent;
                mostFrequentCountEl.textContent = `${odsMetrics[mostFrequent].count} estudos (${odsMetrics[mostFrequent].percentage}%)`;
                addDebugMessage(`‚úÖ ODS mais frequente: ${mostFrequent} (${odsMetrics[mostFrequent].count} estudos)`);
            } else {
                addDebugMessage('‚ùå ERRO: Elementos do ODS mais frequente n√£o encontrados');
            }
            
            // Estudos gerais
            const generalStudiesEl = document.getElementById('generalStudies');
            const generalPercentageEl = document.getElementById('generalPercentage');
            
            if (generalStudiesEl && generalPercentageEl) {
                generalStudiesEl.textContent = odsMetrics['Geral'].count;
                generalPercentageEl.textContent = `${odsMetrics['Geral'].percentage}% do total`;
                addDebugMessage(`‚úÖ Estudos gerais: ${odsMetrics['Geral'].count} (${odsMetrics['Geral'].percentage}%)`);
            } else {
                addDebugMessage('‚ùå ERRO: Elementos de estudos gerais n√£o encontrados');
            }
            
            // ODS identificados
            const identifiedCount = odsKeys.slice(0, 17).filter(ods => odsMetrics[ods].count > 0).length;
            document.getElementById('identifiedODS').textContent = identifiedCount;        }        function generateOdsCards(animated = false) {
            addDebugMessage('üé® Gerando cards dos ODS...');
            
            const grid = document.getElementById('odsGrid');
            if (!grid) {
                addDebugMessage('‚ùå ERRO: Elemento odsGrid n√£o encontrado');
                return;
            }
              // Preparar dados dos ODS
            let odsData = odsKeys.map(ods => ({
                key: ods,
                metrics: odsMetrics[ods] || { count: 0, percentage: 0 },
                iconPath: odsIcons[ods]
            }));
            
            // Verificar se as m√©tricas est√£o dispon√≠veis
            if (!odsMetrics || Object.keys(odsMetrics).length === 0) {
                addDebugMessage('‚ùå ERRO: M√©tricas dos ODS n√£o est√£o dispon√≠veis');
                calculateOdsMetrics(); // Tentar calcular novamente
                return;
            }
            
            addDebugMessage(`üìä Dados preparados: ${odsData.length} ODS`);
            console.log('Dados ODS antes da ordena√ß√£o:', odsData.slice(0, 5).map(d => ({ key: d.key, count: d.metrics.count, percentage: d.metrics.percentage })));              // Aplicar classifica√ß√£o se ativa
            if (sortState.active) {
                odsData = odsData.sort((a, b) => {
                    if (sortState.descending) {
                        return b.metrics.percentage - a.metrics.percentage;
                    } else {
                        return a.metrics.percentage - b.metrics.percentage;
                    }
                });
                
                addDebugMessage(`üî¢ Ordena√ß√£o aplicada: ${sortState.descending ? 'Maior ‚Üí Menor' : 'Menor ‚Üí Maior'} (por percentual)`);
                console.log('Dados ODS ap√≥s ordena√ß√£o:', odsData.slice(0, 5).map(d => ({ key: d.key, count: d.metrics.count, percentage: d.metrics.percentage })));
            }
            
            if (animated) {
                // Anima√ß√£o suave de reorganiza√ß√£o
                animateCardReorganization(odsData, grid);
            } else {
                // Gera√ß√£o normal sem anima√ß√£o
                renderOdsCards(odsData, grid);
            }
            
            addDebugMessage(`‚úÖ ${odsKeys.length} cards gerados com sucesso`);
        }

        function renderOdsCards(odsData, grid) {
            grid.innerHTML = '';
            
            odsData.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'ods-card';
                card.onclick = () => showOdsDetails(item.key);
                card.setAttribute('data-ods', item.key);
                
                // Adicionar indicador de posi√ß√£o se classifica√ß√£o estiver ativa
                const positionIndicator = sortState.active ? 
                    `<div class="position-indicator">${index + 1}</div>` : '';
                
                card.innerHTML = `
                    ${positionIndicator}
                    <img src="${item.iconPath}" alt="${item.key}" class="ods-icon" onerror="this.style.display='none'">
                    <div class="ods-title">${item.key}</div>
                    <div class="ods-count">${item.metrics.count}</div>
                    <div class="ods-percentage">${item.metrics.percentage}%</div>
                `;
                
                // Adicionar classe para mostrar posi√ß√£o se classifica√ß√£o ativa
                if (sortState.active) {
                    card.classList.add('show-position');
                }
                
                grid.appendChild(card);
            });
        }        function animateCardReorganization(odsData, grid) {
            addDebugMessage('üé≠ Iniciando anima√ß√£o FLIP de reorganiza√ß√£o...');
            
            // FASE 1: FIRST - Capturar posi√ß√µes originais
            const originalCards = Array.from(grid.querySelectorAll('.ods-card'));
            const originalPositions = new Map();
            const originalOrder = new Map();
            
            originalCards.forEach((card, index) => {
                const ods = card.getAttribute('data-ods');
                const rect = card.getBoundingClientRect();
                const gridRect = grid.getBoundingClientRect();
                
                originalPositions.set(ods, {
                    x: rect.left - gridRect.left,
                    y: rect.top - gridRect.top,
                    width: rect.width,
                    height: rect.height
                });
                originalOrder.set(ods, index);
            });
            
            // FASE 2: LAST - Criar nova estrutura invis√≠vel
            const tempContainer = document.createElement('div');
            tempContainer.style.position = 'absolute';
            tempContainer.style.top = '0';
            tempContainer.style.left = '0';
            tempContainer.style.width = '100%';
            tempContainer.style.visibility = 'hidden';
            tempContainer.className = grid.className;
            grid.parentNode.appendChild(tempContainer);
            
            renderOdsCards(odsData, tempContainer);
            
            // Capturar novas posi√ß√µes
            const newCards = Array.from(tempContainer.querySelectorAll('.ods-card'));
            const newPositions = new Map();
            
            newCards.forEach((card, index) => {
                const ods = card.getAttribute('data-ods');
                const rect = card.getBoundingClientRect();
                const gridRect = tempContainer.getBoundingClientRect();
                
                newPositions.set(ods, {
                    x: rect.left - gridRect.left,
                    y: rect.top - gridRect.top,
                    index: index
                });
            });
            
            // Remover container tempor√°rio
            tempContainer.remove();
            
            // FASE 3: INVERT - Calcular diferen√ßas e aplicar transforma√ß√µes
            const movePromises = originalCards.map(card => {
                return new Promise(resolve => {
                    const ods = card.getAttribute('data-ods');
                    const originalPos = originalPositions.get(ods);
                    const newPos = newPositions.get(ods);
                    
                    if (!newPos) {
                        resolve();
                        return;
                    }
                    
                    // Calcular diferen√ßa
                    const deltaX = newPos.x - originalPos.x;
                    const deltaY = newPos.y - originalPos.y;
                    
                    // Aplicar transforma√ß√£o inicial (posi√ß√£o invertida)
                    card.classList.add('moving');
                    card.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
                    card.style.zIndex = 1000 + Math.abs(deltaX) + Math.abs(deltaY);
                    
                    // Adicionar efeito de eleva√ß√£o durante movimento
                    if (deltaX !== 0 || deltaY !== 0) {
                        card.style.boxShadow = '0 20px 40px rgba(0,0,0,0.3)';
                        card.style.borderColor = '#007bff';
                    }
                    
                    // FASE 4: PLAY - Animar para posi√ß√£o final
                    requestAnimationFrame(() => {
                        card.style.transition = `transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94), 
                                                box-shadow 0.8s ease, 
                                                border-color 0.8s ease`;
                        card.style.transform = 'translate(0, 0)';
                        
                        // Restaurar estilos ap√≥s anima√ß√£o
                        setTimeout(() => {
                            card.style.boxShadow = '';
                            card.style.borderColor = '';
                            card.style.zIndex = '';
                            card.classList.remove('moving');
                            card.style.transition = '';
                            card.style.transform = '';
                            resolve();
                        }, 800);
                    });
                });
            });
            
            // Aguardar todas as anima√ß√µes terminarem e ent√£o atualizar o DOM
            Promise.all(movePromises).then(() => {
                // Regenerar a estrutura final com indicadores de posi√ß√£o
                renderOdsCards(odsData, grid);
                
                // Aplicar efeitos finais
                const finalCards = Array.from(grid.querySelectorAll('.ods-card'));
                finalCards.forEach((card, index) => {
                    const ods = card.getAttribute('data-ods');
                    
                    // Destacar os top 3 com anima√ß√£o escalonada
                    if (sortState.active && index < 3 && odsData[index].metrics.count > 0) {
                        setTimeout(() => {
                            card.classList.add('highlight');
                            setTimeout(() => card.classList.remove('highlight'), 600);
                        }, index * 150);
                    }
                    
                    // Anima√ß√£o de "chegada" para cards que mudaram muito de posi√ß√£o
                    const originalIndex = originalOrder.get(ods);
                    if (Math.abs(originalIndex - index) > 3) {
                        card.style.opacity = '0';
                        setTimeout(() => {
                            card.style.transition = 'opacity 0.4s ease';
                            card.style.opacity = '1';
                            setTimeout(() => {
                                card.style.transition = '';
                            }, 400);
                        }, 200);
                    }
                });
                
                addDebugMessage('‚ú® Anima√ß√£o FLIP conclu√≠da com sucesso!');
            });
        }        // FUN√á√ÉO PARA ALTERNAR CLASSIFICA√á√ÉO
        function toggleOdsSort() {
            const sortBtn = document.getElementById('sortBtn');
            const sortText = document.getElementById('sortText');
            const sortIcon = sortBtn.querySelector('.sort-icon');
            const overlay = document.getElementById('reorganizingOverlay');
            
            addDebugMessage(`üîÑ toggleOdsSort chamado. Estado atual: active=${sortState.active}, descending=${sortState.descending}`);
            
            // Desabilitar bot√£o durante anima√ß√£o
            sortBtn.disabled = true;
            sortBtn.style.opacity = '0.6';
            
            // Mostrar overlay
            overlay.classList.add('active');
            
            if (!sortState.active) {
                // Ativar classifica√ß√£o (maior para menor)
                sortState.active = true;
                sortState.descending = true;                sortBtn.classList.add('active', 'desc');
                sortText.textContent = 'Maior ‚Üí Menor';
                sortIcon.textContent = '‚Üì';
                
                addDebugMessage('Classifica√ß√£o ativada: Maior ‚Üí Menor (por percentual)');
            } else if (sortState.descending) {
                // Inverter para menor para maior
                sortState.descending = false;
                sortBtn.classList.remove('desc');
                sortText.textContent = 'Menor ‚Üí Maior';
                sortIcon.textContent = '‚Üë';
                
                addDebugMessage('Classifica√ß√£o invertida: Menor ‚Üí Maior (por percentual)');
            } else {
                // Desativar classifica√ß√£o (ordem original)
                sortState.active = false;
                sortBtn.classList.remove('active', 'desc');
                sortText.textContent = 'Classificar por %';
                sortIcon.textContent = '‚Üï';
                
                addDebugMessage('Classifica√ß√£o desativada: Ordem original');
            }
            
            // Debug do estado das m√©tricas antes de gerar cards
            addDebugMessage(`üìä Estado das m√©tricas: ${Object.keys(odsMetrics).length} ODS calculados`);
            console.log('Estado atual das m√©tricas:', odsMetrics);
            console.log('Estado da classifica√ß√£o:', sortState);
            
            // Regenerar cards com anima√ß√£o FLIP
            generateOdsCards(true);
            
            // Reabilitar bot√£o ap√≥s anima√ß√£o
            setTimeout(() => {
                overlay.classList.remove('active');
                sortBtn.disabled = false;
                sortBtn.style.opacity = '1';
                addDebugMessage('‚úÖ Bot√£o de classifica√ß√£o reabilitado');
            }, 1200);
        }

        // NOVAS FUN√á√ïES PARA MELHORIAS

        // 1. SISTEMA DE ABAS
        function switchTab(tabName) {
            // Remover classe active de todas as abas
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            
            // Ativar aba selecionada
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            
            // Inicializar conte√∫do espec√≠fico da aba
            switch(tabName) {
                case 'charts':
                    generateCharts();
                    break;
                case 'temporal':
                    generateTemporalAnalysis();
                    break;
                case 'advanced':
                    generateAdvancedMetrics();
                    break;
            }
        }

        // 2. INICIALIZAR FILTROS
        function initializeFilters() {
            // Filtro de anos
            const years = [...new Set(data.map(item => item.Ano).filter(year => year))].sort();
            const yearSelect = document.getElementById('yearFilter');
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            });

            // Filtro de peri√≥dicos
            const journals = [...new Set(data.map(item => item.Peri√≥dico).filter(journal => journal))].sort();
            const journalSelect = document.getElementById('journalFilter');
            journals.forEach(journal => {
                const option = document.createElement('option');
                option.value = journal;
                option.textContent = journal;
                journalSelect.appendChild(option);
            });

            // Filtro de ODS
            const odsSelect = document.getElementById('odsFilter');
            odsKeys.forEach(ods => {
                const option = document.createElement('option');
                option.value = ods;
                option.textContent = ods;
                odsSelect.appendChild(option);
            });

            // Inicializar dados filtrados
            filteredData = [...data];
        }

        // 3. APLICAR FILTROS
        function applyFilters() {
            const yearFilter = document.getElementById('yearFilter').value;
            const journalFilter = document.getElementById('journalFilter').value;
            const odsFilter = document.getElementById('odsFilter').value;

            filteredData = data.filter(item => {
                if (yearFilter && item.Ano !== yearFilter) return false;
                if (journalFilter && item.Peri√≥dico !== journalFilter) return false;
                if (odsFilter && item[odsFilter] !== 'x') return false;
                return true;
            });

            // Recalcular m√©tricas com dados filtrados
            calculateFilteredMetrics();
            updateVisualizationsWithFilters();
            
            addDebugMessage(`üîç Filtros aplicados: ${filteredData.length} estudos selecionados`);
        }

        // 4. LIMPAR FILTROS
        function clearFilters() {
            document.getElementById('yearFilter').value = '';
            document.getElementById('journalFilter').value = '';
            document.getElementById('odsFilter').value = '';
            filteredData = [...data];
            
            calculateFilteredMetrics();
            updateVisualizationsWithFilters();
            
            addDebugMessage('üîÑ Filtros limpos - mostrando todos os estudos');
        }

        // 5. CALCULAR M√âTRICAS COM FILTROS
        function calculateFilteredMetrics() {
            const currentData = filteredData;
            
            odsKeys.forEach(ods => {
                const count = currentData.filter(item => item[ods] === 'x').length;
                const percentage = currentData.length > 0 ? (count / currentData.length * 100).toFixed(1) : 0;
                odsMetrics[ods] = { count, percentage };
            });

            // Atualizar interface
            document.getElementById('totalStudies').textContent = currentData.length;
            
            const sortedOds = odsKeys.slice(0, 17).sort((a, b) => odsMetrics[b].count - odsMetrics[a].count);
            const mostFrequent = sortedOds[0];
            
            if (odsMetrics[mostFrequent].count > 0) {
                document.getElementById('mostFrequentODS').textContent = mostFrequent;
                document.getElementById('mostFrequentCount').textContent = `${odsMetrics[mostFrequent].count} estudos (${odsMetrics[mostFrequent].percentage}%)`;
            }
            
            document.getElementById('generalStudies').textContent = odsMetrics['Geral'].count;
            document.getElementById('generalPercentage').textContent = `${odsMetrics['Geral'].percentage}% do total`;
            
            const identifiedCount = odsKeys.slice(0, 17).filter(ods => odsMetrics[ods].count > 0).length;
            document.getElementById('identifiedODS').textContent = identifiedCount;
        }

        // 6. GERAR GR√ÅFICOS
        function generateCharts() {
            // Gr√°fico de Distribui√ß√£o (Pizza)
            generateOdsDistributionChart();
            
            // Gr√°fico de Ranking (Barras)
            generateOdsRankingChart();
        }

        function generateOdsDistributionChart() {
            const ctx = document.getElementById('odsDistributionChart').getContext('2d');
            
            // Destruir gr√°fico existente se houver
            if (charts.distribution) {
                charts.distribution.destroy();
            }
            
            const odsData = odsKeys.slice(0, 17).filter(ods => odsMetrics[ods].count > 0);
            const counts = odsData.map(ods => odsMetrics[ods].count);
            const colors = [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#FF6384',
                '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40',
                '#FF6384', '#C9CBCF'
            ];
            
            charts.distribution = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: odsData,
                    datasets: [{
                        data: counts,
                        backgroundColor: colors.slice(0, odsData.length),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        title: {
                            display: true,
                            text: 'Distribui√ß√£o dos Estudos por ODS'
                        }
                    }
                }
            });
        }

        function generateOdsRankingChart() {
            const ctx = document.getElementById('odsRankingChart').getContext('2d');
            
            if (charts.ranking) {
                charts.ranking.destroy();
            }
            
            const sortedOds = odsKeys.slice(0, 17)
                .map(ods => ({ ods, count: odsMetrics[ods].count }))
                .filter(item => item.count > 0)
                .sort((a, b) => b.count - a.count);
            
            charts.ranking = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedOds.map(item => item.ods),
                    datasets: [{
                        label: 'N√∫mero de Estudos',
                        data: sortedOds.map(item => item.count),
                        backgroundColor: '#007bff',
                        borderColor: '#0056b3',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Ranking dos ODS por N√∫mero de Estudos'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                },
            });
        }

        // 7. AN√ÅLISE TEMPORAL
        function generateTemporalAnalysis() {
            generateTemporalChart();
            generateTemporalStats();
        }

        function generateTemporalChart() {
            const ctx = document.getElementById('temporalChart').getContext('2d');
            
            if (charts.temporal) {
                charts.temporal.destroy();
            }
            
            // Agrupar por ano
            const yearData = {};
            filteredData.forEach(item => {
                const year = item.Ano;
                if (year) {
                    yearData[year] = (yearData[year] || 0) + 1;
                }
            });
            
            const years = Object.keys(yearData).sort();
            const counts = years.map(year => yearData[year]);
            
            charts.temporal = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Estudos Publicados',
                        data: counts,
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Evolu√ß√£o Temporal das Publica√ß√µes'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function generateTemporalStats() {
            const container = document.getElementById('temporalStats');
            
            // Calcular estat√≠sticas temporais
            const years = [...new Set(filteredData.map(item => item.Ano).filter(year => year))].sort();
            const totalYears = years.length;
            const avgPerYear = filteredData.length / totalYears;
            
            // Tend√™ncia
            let trend = 'stable';
            if (years.length >= 3) {
                const recent = years.slice(-3);
                const recentCounts = recent.map(year => 
 
                    filteredData.filter(item => item.Ano === year).length
                );
                const firstHalf = recentCounts.slice(0, Math.ceil(recentCounts.length / 2));
                const secondHalf = recentCounts.slice(Math.floor(recentCounts.length / 2));
                const avgFirst = firstHalf.reduce((a, b) => a + b, 0) / firstHalf.length;
                const avgSecond = secondHalf.reduce((a, b) => a + b, 0) / secondHalf.length;
                
                if (avgSecond > avgFirst * 1.2) trend = 'up';
                else if (avgSecond < avgFirst * 0.8) trend = 'down';
            }
            
            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Per√≠odo de An√°lise</div>
                    <div class="stat-value">${years[0]} - ${years[years.length - 1]}</div>
                    <div class="stat-label">${totalYears} anos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">M√©dia por Ano</div>
                    <div class="stat-value">${avgPerYear.toFixed(1)}</div>
                    <div class="stat-label">estudos/ano</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Tend√™ncia Recente</div>
                    <div class="stat-value">
                        <span class="trend-indicator trend-${trend}">
                            ${trend === 'up' ? 'üìà' : trend === 'down' ? 'üìâ' : 'üìä'}
                            ${trend === 'up' ? 'Crescimento' : trend === 'down' ? 'Decl√≠nio' : 'Est√°vel'}
                        </span>
                    </div>
                </div>
            `;
        }

        // 8. M√âTRICAS AVAN√áADAS
        function generateAdvancedMetrics() {
            generateAdvancedStats();
            generateCorrelationMatrix();
        }

        function generateAdvancedStats() {
            const container = document.getElementById('advancedStats');
            
            // Calcular estat√≠sticas avan√ßadas
            const totalOdsCount = odsKeys.slice(0, 17).reduce((sum, ods) => sum + odsMetrics[ods].count, 0);
            const avgOdsPerStudy = totalOdsCount / filteredData.length;
            const maxOds = Math.max(...odsKeys.slice(0, 17).map(ods => odsMetrics[ods].count));
            const diversityIndex = odsKeys.slice(0, 17).filter(ods => odsMetrics[ods].count > 0).length / 17;
            
            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">√çndice de Diversidade</div>
                    <div class="stat-value">${(diversityIndex * 100).toFixed(1)}%</div>
                    <div class="stat-label">dos ODS representados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">M√©dia ODS/Estudo</div>
                    <div class="stat-value">${avgOdsPerStudy.toFixed(1)}</div>
                    <div class="stat-label">ODS por estudo</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Concentra√ß√£o M√°xima</div>
                    <div class="stat-value">${maxOds}</div>
                    <div class="stat-label">estudos no ODS principal</div>
                </div>
            `;
        }

        function generateCorrelationMatrix() {
            const container = document.getElementById('correlationMatrix');
            
            // Calcular matriz de correla√ß√£o simples (co-ocorr√™ncia)
            const odsSubset = odsKeys.slice(0, 17).filter(ods => odsMetrics[ods].count > 0);
            
            let html = '<table class="correlation-table"><thead><tr><th>ODS</th>';
            odsSubset.forEach(ods => {
                html += `<th>${ods.replace('ODS ', '')}</th>`;
            });
            html += '</tr></thead><tbody>';
            
            odsSubset.forEach(ods1 => {
                html += `<tr><td><strong>${ods1}</strong></td>`;
                odsSubset.forEach(ods2 => {
                    // Calcular co-ocorr√™ncia
                    const coOccurrence = filteredData.filter(item => 
                        item[ods1] === 'x' && item[ods2] === 'x'
                    ).length;
                    
                    const correlation = ods1 === ods2 ? 1 : 
                        (coOccurrence / Math.min(odsMetrics[ods1].count, odsMetrics[ods2].count));
                    
                    let cssClass = 'correlation-low';
                    if (correlation > 0.7) cssClass = 'correlation-high';
                    else if (correlation > 0.3) cssClass = 'correlation-medium';
                    
                    html += `<td class="${cssClass}">${correlation.toFixed(2)}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // 9. ATUALIZAR VISUALIZA√á√ïES COM FILTROS
        function updateVisualizationsWithFilters() {
            generateOdsCards();
            
            // Atualizar gr√°ficos se estiverem vis√≠veis
            if (!document.getElementById('chartsTab').classList.contains('hidden')) {
                generateCharts();
            }
            if (!document.getElementById('temporalTab').classList.contains('hidden')) {
                generateTemporalAnalysis();
            }
            if (!document.getElementById('advancedTab').classList.contains('hidden')) {
                generateAdvancedMetrics();
            }
        }

        function showOdsDetails(ods) {
            const relatedStudies = data.filter(item => item[ods] === 'x');
            const metrics = odsMetrics[ods];
            
            document.getElementById('detailsTitle').textContent = ods;
            document.getElementById('detailsSubtitle').textContent = 
                `${metrics.count} estudos (${metrics.percentage}% do total)`;
            
            const content = document.getElementById('detailsContent');
            
            if (relatedStudies.length === 0) {
                content.innerHTML = '<p style="text-align: center; color: #666; padding: 30px;">Nenhum estudo encontrado para este ODS.</p>';
            } else {
                content.innerHTML = relatedStudies.map(study => `
                    <div class="study-card">
                        <h4 style="color: #333; margin-bottom: 8px; font-size: 0.9rem;">
                            ${study.Autores} (${study.Ano})
                        </h4>
                        <p style="font-weight: 600; margin-bottom: 6px; font-size: 0.85rem;">
                            ${study.T√≠tulo}
                        </p>
                        <p style="color: #666; font-size: 0.8rem; margin-bottom: 6px;">
                            ${study.Peri√≥dico} ‚Ä¢ ${study.Categorias}
                        </p>
                        <p style="font-size: 0.75rem; color: #888;">
                            <strong>Aspecto:</strong> ${study['Aspecto Principal - Estudo']}
                        </p>
                    </div>
                `).join('');
            }
            
            document.getElementById('detailsPanel').classList.add('active');
        }

        function closeDetails() {
            document.getElementById('detailsPanel').classList.remove('active');
        }

        function showAllStudies() {
            document.getElementById('detailsTitle').textContent = 'Todos os Estudos';
            document.getElementById('detailsSubtitle').textContent = `${data.length} estudos no total`;
            
            const content = document.getElementById('detailsContent');
            content.innerHTML = data.map(study => `
                <div class="study-card">
                    <h4 style="color: #333; margin-bottom: 8px; font-size: 0.9rem;">
                        [${study.ID}] ${study.Autores} (${study.Ano})
                    </h4>
                    <p style="font-weight: 600; margin-bottom: 6px; font-size: 0.85rem;">
                        ${study.T√≠tulo}
                    </p>
                    <p style="color: #666; font-size: 0.8rem; margin-bottom: 6px;">
                        ${study.Peri√≥dico} ‚Ä¢ ${study.Categorias}
                    </p>
                    <p style="font-size: 0.75rem; color: #888;">
                        <strong>ODS:</strong> ${study['ODS (Geral / Espec√≠fico)']}
                    </p>
                </div>
            `).join('');
            
            document.getElementById('detailsPanel').classList.add('active');
        }

        function showStatistics() {
            const totalWithOds = odsKeys.slice(0, 17).reduce((sum, ods) => sum + odsMetrics[ods].count, 0);
            const avgPerOds = (totalWithOds / 17).toFixed(1);
            
            const sortedOds = odsKeys.slice(0, 17).sort((a, b) => odsMetrics[b].count - odsMetrics[a].count);
            
            document.getElementById('detailsTitle').textContent = 'Estat√≠sticas Detalhadas';
            document.getElementById('detailsSubtitle').textContent = 'An√°lise completa dos dados';
            
            const content = document.getElementById('detailsContent');
            content.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #333; margin-bottom: 10px; font-size: 1rem;">Resumo Estat√≠stico</h4>
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; font-size: 0.9rem;">
                        <p><strong>Total de estudos:</strong> ${data.length}</p>
                        <p><strong>Estudos com ODS espec√≠ficos:</strong> ${totalWithOds}</p>
                        <p><strong>Estudos gerais:</strong> ${odsMetrics['Geral'].count}</p>
                        <p><strong>M√©dia por ODS:</strong> ${avgPerOds} estudos</p>
                        <p><strong>ODS mais abordados:</strong> ${sortedOds.slice(0, 3).map(ods => `${ods} (${odsMetrics[ods].count})`).join(', ')}</p>
                    </div>
                </div>
                
                <h4 style="color: #333; margin-bottom: 10px; font-size: 1rem;">Ranking dos ODS</h4>
                ${sortedOds.map((ods, index) => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; margin-bottom: 6px; background: ${index < 3 ? '#e8f5e8' : '#f8f9fa'}; border-radius: 4px; font-size: 0.85rem;">
                        <span><strong>${index + 1}¬∫</strong> ${ods}</span>
                        <span><strong>${odsMetrics[ods].count}</strong> (${odsMetrics[ods].percentage}%)</span>
                    </div>
                `).join('')}
            `;
            
            document.getElementById('detailsPanel').classList.add('active');
        }

        function showTableView() {
            document.getElementById('tableSection').classList.remove('hidden');
            document.getElementById('metricsSection').classList.add('hidden');
            document.getElementById('tableControls').style.display = 'block';
            
            document.getElementById('tableViewBtn').classList.add('active');
            document.getElementById('metricsViewBtn').classList.remove('active');
        }        function showMetricsView() {
            addDebugMessage('üîÑ Ativando visualiza√ß√£o de m√©tricas...');
            
            document.getElementById('tableSection').classList.add('hidden');
            document.getElementById('metricsSection').classList.remove('hidden');
            document.getElementById('tableControls').style.display = 'none';
            
            document.getElementById('metricsViewBtn').classList.add('active');
            document.getElementById('tableViewBtn').classList.remove('active');
            
            // Inicializar filtros se ainda n√£o foram inicializados
            if (document.getElementById('yearFilter').children.length === 1) {
                addDebugMessage('üîß Inicializando filtros...');
                initializeFilters();
            }
            
            // Garantir que os dados estejam dispon√≠veis
            if (typeof data === 'undefined' || !data || data.length === 0) {
                addDebugMessage('‚ùå ERRO: Dados n√£o dispon√≠veis na visualiza√ß√£o de m√©tricas');
                return;
            }
            
            // Calcular e gerar m√©tricas
            addDebugMessage('Calculando m√©tricas dos ODS...');
            calculateOdsMetrics();
            
            // Resetar estado da classifica√ß√£o ao entrar na visualiza√ß√£o
            sortState.active = false;
            const sortBtn = document.getElementById('sortBtn');
            const sortText = document.getElementById('sortText');
            const sortIcon = sortBtn.querySelector('.sort-icon');            if (sortBtn && sortText && sortIcon) {
                sortBtn.classList.remove('active', 'desc');
                sortText.textContent = 'Classificar por %';
                sortIcon.textContent = '‚Üï';
            }
            
            generateOdsCards();
            
            addDebugMessage('Visualiza√ß√£o de m√©tricas ativada com melhorias');
        }

        // Fechar painel ao clicar fora
        document.addEventListener('click', function(e) {
            const panel = document.getElementById('detailsPanel');
            if (panel.classList.contains('active') && !panel.contains(e.target) && !e.target.closest('.ods-card') && !e.target.closest('.btn')) {
                closeDetails();
            }
        });
          // INICIALIZAR QUANDO A P√ÅGINA CARREGAR
        document.addEventListener('DOMContentLoaded', function() {
            // Aguardar um pouco para garantir que o script externo seja carregado
            setTimeout(function() {
                initializeApp();
                // Inicializar com visualiza√ß√£o de tabela
                showTableView();
            }, 100);
        });
        
        // LOG DE FUN√á√ïES DISPON√çVEIS
        window.addEventListener('load', function() {
            console.log('P√°gina totalmente carregada');
            console.log('Tipo de data:', typeof data);
            console.log('Dados dispon√≠veis:', data ? data.length : 0);
        });
    </script>
    
    <!-- Rodap√© Acad√™mico -->
    <footer style="margin-top: 40px; padding: 25px 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-top: 3px solid #007bff; text-align: center; border-radius: 0 0 10px 10px;">
        <div style="max-width: 800px; margin: 0 auto;">
            <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #dee2e6;">                <h4 style="color: #495057; margin: 0 0 8px 0; font-size: 1.1rem;">
                    Disserta√ß√£o de Mestrado
                </h4>
                <p style="margin: 5px 0; color: #6c757d; font-size: 0.95rem; line-height: 1.4;">
                    <em>"Cidades Inteligentes como Vetores para os ODS: Sinergias, Desafios e Oportunidades<br>
                    para o Desenvolvimento Urbano Sustent√°vel atrav√©s de uma RSL"</em>
                </p>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; flex-wrap: wrap; gap: 15px;">
                <div style="text-align: left; flex: 1; min-width: 200px;">
                    <div style="font-size: 0.85rem; color: #6c757d; margin-bottom: 5px;">
                        <strong>Universidade Est√°cio de S√° - UNESA</strong>
                    </div>
                    <div style="font-size: 0.8rem; color: #6c757d;">
                        Mestrado em Administra√ß√£o e Desenvolvimento Empresarial
                    </div>
                </div>
                
                <div style="text-align: right; flex: 1; min-width: 200px;">                    <div style="font-size: 0.9rem; color: #495057; font-weight: 600;">
                        Desenvolvido por: <strong>Luciano Marinho Silveira</strong>
                    </div>
                    <div style="font-size: 0.8rem; color: #6c757d; margin-top: 5px;">
                        Mestrando ‚Ä¢ 2025
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #dee2e6; font-size: 0.75rem; color: #6c757d;">
                Ferramenta de an√°lise interativa para visualiza√ß√£o de dados da Revis√£o Sistem√°tica da Literatura
            </div>
        </div>
    </footer>
</body>
</html>